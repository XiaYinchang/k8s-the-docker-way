## Download docker image

#### hyperkube

```
docker pull gcr.io/google-containers/hyperkube:v1.8.4
```

#### etcd

```
docker pull quay.io/coreos/etcd
```


## SSL certificate


#### root ca
generate ca.key
```
openssl ecparam -name secp1024r1 -genkey -noout -out ca.key
```
generate ca.crt

```
openssl req -x509 -new -sha256 -nodes -key ca.key -days 3650 -out ca.crt -subj "/CN=k8s-ca"  -extensions v3_ca -config ./openssl.conf
```

view ca
```
openssl ec -in ca.key -noout -text
openssl x509 -in ca.crt -noout -text
```


#### apiserver crt
generate apiserver.key
```
openssl ecparam -name secp521r1 -genkey -noout -out apiserver.key
```

generate apiserver.crt
```
openssl req -new -sha256 -key apiserver.key -subj "/CN=kube-apiserver" | openssl x509 -req -sha256 -CA ca.crt -CAkey ca.key -CAcreateserial -out apiserver.crt -days 3650 -extensions v3_apiserver -extfile ./openssl.cnf
```

view apiserver crt
```
openssl ec -in apiserver.key -noout -text
openssl x509 -in apiserver.crt -noout -text
```
#### kubectl crt
generate admin.key
```
openssl ecparam -name secp521r1 -genkey -noout -out admin.key
```

generate admin.crt
```
openssl req -new -key admin.key -subj "/CN=kube-admin/O=system:masters" | openssl x509 -req -sha256 -CA ca.crt -CAkey ca.key -CAcreateserial -out admin.crt -days 3650 -extensions v3_client -extfile ./openssl.cnf
```

view admin crt
```
openssl ec -in admin.key -noout -text
openssl x509 -in admin.crt -noout -text
```

#### scheduler crt

generate shcedulet.key

```
openssl ecparam -name secp521r1 -genkey -noout -out scheduler.key
```

generate scheduler.crt

```
 openssl req -new -sha256 -key scheduler.key -subj "/CN=system:kube-scheduler" | openssl x509 -req -sha256 -CA ca.crt -CAkey ca.key -CAcreateserial -out scheduler.crt -days 3650 -extensions v3_client -extfile ./openssl.cnf
```

view scheduler crt
```
openssl ec -in scheduler.key -noout -text
openssl x509 -in scheduler.crt -noout -text
```

#### control manager crt && service account crt
generate cm.key and sa.key

```
openssl ecparam -name secp521r1 -genkey -noout -out cm.key
cp cm.key sa.key
```

generate sa pub
```
openssl ec -in sa.key -outform PEM -pubout -out sa.pub
```

generate cm crt

```
openssl req -new -sha256 -key cm.key -subj "/CN=system:kube-controller-manager" | openssl x509 -req -sha256 -CA ca.crt -CAkey ca.key -CAcreateserial -out cm.crt -days 3650 -extensions v3_client -extfile ./openssl.cnf

```

view cm and sa crt

```
openssl ec -in cm.key -noout -text
openssl ec -in sa.pub  -pubin -noout -text
openssl x509 -in cm.crt -noout -text
```

#### kubelet client crt

generate kubelet-client.key
```
 openssl ecparam -name secp521r1 -genkey -noout -out kubelet-client.key
```

generate kubelet-client.crt
```
openssl req -new -key kubelet-client.key -subj "/CN=kube-apiserver-kubelet-client/O=system:masters" | openssl x509 -req -sha256 -CA ca.crt -CAkey ca.key -CAcreateserial -out kubelet-client.crt -days 3650 -extensions v3_client -extfile ./openssl.cnf
```

view kubelet-client crt 
```
openssl ec -in kubelet-client.key -noout -text
openssl x509 -in kubelet-client.crt -noout -text
```

## generate kubeconfig